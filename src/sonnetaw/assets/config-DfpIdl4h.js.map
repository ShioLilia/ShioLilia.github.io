{"version":3,"file":"config-DfpIdl4h.js","sources":["../../src/dictionary.ts","../../src/config.ts"],"sourcesContent":["import type { PronunciationDict, Syllable, WordAnalysis } from './types';\r\n\r\n/**\r\n * Dictionary service for loading and querying pronunciation data\r\n */\r\nexport class DictionaryService {\r\n  private dict: PronunciationDict = {};\r\n  private currentLanguage: string = 'en'; // 当前加载的语言\r\n  private customDict: PronunciationDict = {}; // 用户自定义词典\r\n\r\n  /**\r\n   * Load pronunciation dictionary from JSON data\r\n   */\r\n  async loadDictionary(dictData: PronunciationDict, languageCode: string = 'en'): Promise<void> {\r\n    this.dict = dictData;\r\n    this.currentLanguage = languageCode;\r\n    // Load custom dictionary from localStorage if available\r\n    this.loadCustomDictionary();\r\n  }\r\n\r\n  /**\r\n   * Load custom dictionary from localStorage\r\n   */\r\n  private loadCustomDictionary(): void {\r\n    try {\r\n      const stored = localStorage.getItem(`customDict_${this.currentLanguage}`);\r\n      if (stored) {\r\n        this.customDict = JSON.parse(stored);\r\n        console.log(`Loaded ${Object.keys(this.customDict).length} custom words`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load custom dictionary:', error);\r\n      this.customDict = {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save custom dictionary to localStorage\r\n   */\r\n  private saveCustomDictionary(): void {\r\n    try {\r\n      localStorage.setItem(\r\n        `customDict_${this.currentLanguage}`,\r\n        JSON.stringify(this.customDict)\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to save custom dictionary:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a custom word pronunciation\r\n   */\r\n  addCustomWord(word: string, phonemes: string[]): void {\r\n    const normalized = word.toLowerCase().replace(/[^a-z']/g, '');\r\n    this.customDict[normalized] = [phonemes];\r\n    this.saveCustomDictionary();\r\n  }\r\n\r\n  /**\r\n   * Get current language code\r\n   */\r\n  getCurrentLanguage(): string {\r\n    return this.currentLanguage;\r\n  }\r\n\r\n  /**\r\n   * Look up a word in the dictionary\r\n   * Returns the first pronunciation if multiple exist\r\n   * Checks custom dictionary first, then main dictionary\r\n   */\r\n  lookup(word: string): string[] | null {\r\n    const normalized = word.toLowerCase().replace(/[^a-z']/g, '');\r\n    \r\n    // Check custom dictionary first\r\n    if (this.customDict[normalized]?.length > 0) {\r\n      return this.customDict[normalized][0];\r\n    }\r\n    \r\n    // Then check main dictionary\r\n    const pronunciations = this.dict[normalized];\r\n    if (!pronunciations || pronunciations.length === 0) {\r\n      return null;\r\n    }\r\n    return pronunciations[0]; // Return first pronunciation\r\n  }\r\n\r\n  /**\r\n   * Get all pronunciations for a word\r\n   * Returns all available pronunciations, or null if word not found\r\n   */\r\n  getAllPronunciations(word: string): string[][] | null {\r\n    const normalized = word.toLowerCase().replace(/[^a-z']/g, '');\r\n    \r\n    // Check custom dictionary first\r\n    if (this.customDict[normalized]?.length > 0) {\r\n      return this.customDict[normalized];\r\n    }\r\n    \r\n    // Then check main dictionary\r\n    const pronunciations = this.dict[normalized];\r\n    if (!pronunciations || pronunciations.length === 0) {\r\n      return null;\r\n    }\r\n    return pronunciations;\r\n  }\r\n\r\n  /**\r\n   * Extract syllables from phonemes\r\n   * A syllable contains one vowel sound (phonemes ending in 0, 1, or 2)\r\n   */\r\n  extractSyllables(phonemes: string[]): Syllable[] {\r\n    const syllables: Syllable[] = [];\r\n    let currentSyllable: string[] = [];\r\n    let currentStress: 0 | 1 | 2 = 0;\r\n\r\n    for (const phoneme of phonemes) {\r\n      currentSyllable.push(phoneme);\r\n      \r\n      // Check if this phoneme contains stress information (ends with 0, 1, or 2)\r\n      const stressMatch = phoneme.match(/[012]$/);\r\n      if (stressMatch) {\r\n        currentStress = parseInt(stressMatch[0]) as 0 | 1 | 2;\r\n        syllables.push({\r\n          phonemes: currentSyllable,\r\n          stress: currentStress\r\n        });\r\n        currentSyllable = [];\r\n        currentStress = 0;\r\n      }\r\n    }\r\n\r\n    // Add any remaining consonants to the last syllable\r\n    if (currentSyllable.length > 0 && syllables.length > 0) {\r\n      syllables[syllables.length - 1].phonemes.push(...currentSyllable);\r\n    }\r\n\r\n    return syllables;\r\n  }\r\n\r\n  /**\r\n   * Extract rhyme key from phonemes\r\n   * The rhyme key consists of phonemes from the last primary stressed vowel to the end\r\n   */\r\n  extractRhymeKey(phonemes: string[]): string {\r\n    // Find the last vowel (phoneme with stress marker 0, 1, or 2)\r\n    let lastVowelIndex = -1;\r\n    for (let i = phonemes.length - 1; i >= 0; i--) {\r\n      if (phonemes[i].match(/[012]$/)) {\r\n        lastVowelIndex = i;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (lastVowelIndex === -1) {\r\n      // No vowel found in this word (all consonants), return empty\r\n      // The caller should look for the previous vowel in the line\r\n      return '';\r\n    }\r\n\r\n    // Return from last vowel to end, removing stress markers\r\n    return phonemes\r\n      .slice(lastVowelIndex)\r\n      .map(p => p.replace(/[012]$/, ''))\r\n      .join('-');\r\n  }\r\n\r\n  /**\r\n   * Heuristic syllable count for unknown words\r\n   * Based on vowel groups and English pronunciation rules\r\n   * For other languages, this method should be overridden\r\n   */\r\n  private estimateSyllables(word: string): number {\r\n    if (this.currentLanguage === 'en') {\r\n      return this.estimateSyllablesEnglish(word);\r\n    }\r\n    // For other languages, add specific methods\r\n    // else if (this.currentLanguage === 'la') return this.estimateSyllablesLatin(word);\r\n    return this.estimateSyllablesEnglish(word); // Default fallback\r\n  }\r\n\r\n  /**\r\n   * Advanced English syllable estimation\r\n   * Implements comprehensive rules for better accuracy\r\n   */\r\n  private estimateSyllablesEnglish(word: string): number {\r\n    const lower = word.toLowerCase().replace(/[^a-z]/g, '');\r\n    if (lower.length === 0) return 1;\r\n    \r\n    // Special cases - common words with irregular syllabification\r\n    const specialCases: { [key: string]: number } = {\r\n      // Single syllable despite multiple vowels\r\n      'are': 1, 'were': 1, 'where': 1, 'here': 1, 'there': 1,\r\n      'fire': 1, 'hour': 1, 'our': 1, 'your': 1,\r\n      'through': 1, 'though': 1, 'thought': 1, 'brought': 1,\r\n      'sure': 1, 'pure': 1, 'cure': 1,\r\n      \r\n      // Two syllables\r\n      'every': 2, 'prayer': 2, 'player': 2, 'layer': 2,\r\n      'being': 2, 'seeing': 2, 'doing': 2, 'going': 2,\r\n      \r\n      // Three syllables\r\n      'family': 3, 'library': 3, 'different': 3,\r\n      \r\n      // Common archaic/poetic words\r\n      'thee': 1, 'thou': 1, 'thy': 1, 'thine': 1,\r\n      'hath': 1, 'doth': 1, 'shalt': 1, 'wilt': 1,\r\n      'ere': 1, 'oft': 1, 'nigh': 1,\r\n      'oer': 1, 'eer': 1, 'neer': 1, // o'er, e'er, ne'er\r\n      'tis': 1, 'twas': 1, 'twere': 1,\r\n    };\r\n    \r\n    if (specialCases[lower]) {\r\n      return specialCases[lower];\r\n    }\r\n    \r\n    let count = 0;\r\n    const vowels = 'aeiouy';\r\n    let previousWasVowel = false;\r\n    \r\n    // Count vowel groups\r\n    for (let i = 0; i < lower.length; i++) {\r\n      const char = lower[i];\r\n      const isVowel = vowels.includes(char);\r\n      \r\n      if (isVowel && !previousWasVowel) {\r\n        count++;\r\n      }\r\n      previousWasVowel = isVowel;\r\n    }\r\n    \r\n    // Apply English-specific rules\r\n    \r\n    // Rule 1: Silent 'e' at the end\r\n    if (lower.endsWith('e')) {\r\n      // But not after certain patterns\r\n      if (count > 1 && !lower.match(/(le|re|ne|me|he|se|ze|ve|de|ge|te|ce|pe)$/)) {\r\n        count--;\r\n      }\r\n      // Exceptions: -le, -tle, -ble, -ple, etc. after consonant\r\n      if (lower.match(/[^aeiou]le$/)) {\r\n        // 'le' after consonant adds a syllable (e.g., \"table\" = 2)\r\n        // Already counted correctly, do nothing\r\n      }\r\n    }\r\n    \r\n    // Rule 2: -ed ending\r\n    if (lower.endsWith('ed')) {\r\n      // Usually doesn't add syllable except after 'd' or 't'\r\n      if (!lower.match(/[dt]ed$/)) {\r\n        count--;\r\n      }\r\n    }\r\n    \r\n    // Rule 3: -es ending\r\n    if (lower.endsWith('es') && lower.length > 2) {\r\n      const beforeEs = lower.slice(-3, -2);\r\n      // -es adds syllable after s, z, x, ch, sh (e.g., \"boxes\", \"wishes\")\r\n      if (!'szx'.includes(beforeEs) && !lower.endsWith('ches') && !lower.endsWith('shes')) {\r\n        count--;\r\n      }\r\n    }\r\n    \r\n    // Rule 4: -ing, -ting, -ding usually don't add extra syllable\r\n    // (already handled by vowel counting, but verify)\r\n    \r\n    // Rule 5: Diphthongs that should be one syllable\r\n    // ea, ee, oo, ou, oi, ay, ey, ow are usually one vowel sound\r\n    // (already handled by consecutive vowel grouping)\r\n    \r\n    // Rule 6: -tion, -sion, -cion endings\r\n    if (lower.match(/(tion|sion|cion)$/)) {\r\n      // These are usually 2 syllables: -ti-on, -si-on\r\n      // The 'io' is counted as one vowel group, but should be 2\r\n      count++;\r\n    }\r\n    \r\n    // Rule 7: -ious, -eous endings\r\n    if (lower.match(/(ious|eous)$/)) {\r\n      // e.g., \"curious\" = 3, \"gorgeous\" = 2\r\n      // 'ious' has 2 syllable sounds despite consecutive vowels\r\n      count++;\r\n    }\r\n    \r\n    // Rule 8: -ia, -iu, -io at the end often form separate syllable\r\n    if (lower.match(/(ia|iu|io)$/) && lower.length > 3) {\r\n      // e.g., \"California\" - 'ia' is separate\r\n      const before = lower[lower.length - 3];\r\n      if (!vowels.includes(before)) {\r\n        count++;\r\n      }\r\n    }\r\n    \r\n    // Rule 9: Three+ consecutive vowels might be multiple syllables\r\n    const tripleVowelMatch = lower.match(/[aeiouy]{3,}/g);\r\n    if (tripleVowelMatch) {\r\n      for (const match of tripleVowelMatch) {\r\n        // \"beautiful\" has \"eau\" but it's 1 syllable in that context\r\n        // Add logic for specific patterns if needed\r\n      }\r\n    }\r\n    \r\n    // Rule 10: Y between consonants acts as vowel\r\n    // (already handled by including 'y' in vowels)\r\n    \r\n    return Math.max(1, count); // At least 1 syllable\r\n  }\r\n\r\n  /**\r\n   * Create fallback analysis for unknown words\r\n   * Attempts to guess stress patterns based on English rules\r\n   */\r\n  private createFallbackAnalysis(word: string): WordAnalysis {\r\n    const syllableCount = this.estimateSyllables(word);\r\n    const syllables: Syllable[] = [];\r\n    \r\n    // Guess stress position based on syllable count and word patterns\r\n    let stressPosition = 0; // Which syllable gets primary stress (0-indexed)\r\n    \r\n    if (syllableCount === 1) {\r\n      stressPosition = 0;\r\n    } else if (syllableCount === 2) {\r\n      // For 2-syllable words, stress is often on first syllable\r\n      // But suffixes like -tion, -ment, -ly shift stress earlier\r\n      const lower = word.toLowerCase();\r\n      if (lower.match(/(ment|ness|less|ful|ly)$/)) {\r\n        stressPosition = 0; // Stress before suffix\r\n      } else if (lower.match(/(tion|sion|ic)$/)) {\r\n        stressPosition = 0; // Stress before -tion\r\n      } else {\r\n        stressPosition = 0; // Default: first syllable\r\n      }\r\n    } else if (syllableCount >= 3) {\r\n      // For 3+ syllable words, stress is often on first or second syllable\r\n      const lower = word.toLowerCase();\r\n      if (lower.match(/(tion|sion)$/)) {\r\n        stressPosition = Math.max(0, syllableCount - 3); // Before -tion\r\n      } else if (lower.match(/(ic|ical)$/)) {\r\n        stressPosition = Math.max(0, syllableCount - 3); // Before -ic\r\n      } else if (lower.match(/(ity|ety)$/)) {\r\n        stressPosition = Math.max(0, syllableCount - 3); // Before -ity\r\n      } else {\r\n        stressPosition = Math.min(1, syllableCount - 1); // Second syllable or first\r\n      }\r\n    }\r\n    \r\n    // Create syllable structure\r\n    for (let i = 0; i < syllableCount; i++) {\r\n      const stress: 0 | 1 | 2 = \r\n        i === stressPosition ? 1 : // Primary stress\r\n        0;                          // Unstressed\r\n      \r\n      syllables.push({\r\n        phonemes: [],\r\n        stress\r\n      });\r\n    }\r\n    \r\n    // Create a basic rhyme key from the last 2-3 characters\r\n    const rhymeKey = word.length >= 2 ? \r\n      word.slice(-2).toLowerCase() : \r\n      word.toLowerCase();\r\n    \r\n    return {\r\n      word: word.toLowerCase(),\r\n      originalWord: word,\r\n      syllables,\r\n      rhymeKey,\r\n      found: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Map phonemes to letter positions in the word\r\n   * Returns array of letter ranges for each syllable: [startIdx, endIdx]\r\n   */\r\n  syllabifyWord(word: string, syllables: Syllable[]): Array<[number, number]> {\r\n    const lower = word.toLowerCase();\r\n    const vowels = 'aeiouy';\r\n    const result: Array<[number, number]> = [];\r\n    \r\n    // Find all vowel positions in the word\r\n    const vowelPositions: number[] = [];\r\n    for (let i = 0; i < lower.length; i++) {\r\n      if (vowels.includes(lower[i])) {\r\n        vowelPositions.push(i);\r\n      }\r\n    }\r\n    \r\n    if (vowelPositions.length === 0 || syllables.length === 0) {\r\n      // No vowels or syllables, return whole word as one unit\r\n      return [[0, word.length - 1]];\r\n    }\r\n    \r\n    // If syllable count doesn't match vowel count, use simple division\r\n    if (syllables.length !== vowelPositions.length) {\r\n      // Fallback: divide word evenly\r\n      const avgLength = word.length / syllables.length;\r\n      for (let i = 0; i < syllables.length; i++) {\r\n        const start = Math.floor(i * avgLength);\r\n        const end = i === syllables.length - 1 ? word.length - 1 : Math.floor((i + 1) * avgLength) - 1;\r\n        result.push([start, end]);\r\n      }\r\n      return result;\r\n    }\r\n    \r\n    // Apply syllabification rules based on consonants between vowels\r\n    for (let i = 0; i < vowelPositions.length; i++) {\r\n      const vowelPos = vowelPositions[i];\r\n      let start: number;\r\n      let end: number;\r\n      \r\n      if (i === 0) {\r\n        // First syllable: starts from beginning\r\n        start = 0;\r\n      } else {\r\n        // Find consonants between this vowel and previous vowel\r\n        const prevVowel = vowelPositions[i - 1];\r\n        const consonantCount = vowelPos - prevVowel - 1;\r\n        \r\n        if (consonantCount === 0) {\r\n          // Two vowels adjacent: split between them\r\n          start = vowelPos;\r\n        } else if (consonantCount === 1) {\r\n          // One consonant: goes to current syllable\r\n          start = prevVowel + 1;\r\n        } else if (consonantCount === 2) {\r\n          // Two consonants: split 1+1\r\n          start = prevVowel + 2;\r\n        } else if (consonantCount === 3) {\r\n          // Three consonants: split 2+1\r\n          start = prevVowel + 3;\r\n        } else {\r\n          // Four or more: split evenly\r\n          const half = Math.floor(consonantCount / 2);\r\n          start = prevVowel + 1 + half;\r\n        }\r\n      }\r\n      \r\n      if (i === vowelPositions.length - 1) {\r\n        // Last syllable: goes to end\r\n        end = word.length - 1;\r\n      } else {\r\n        // Find split point with next syllable\r\n        const nextVowel = vowelPositions[i + 1];\r\n        const consonantCount = nextVowel - vowelPos - 1;\r\n        \r\n        if (consonantCount === 0) {\r\n          // Two vowels adjacent: include current vowel only\r\n          end = vowelPos;\r\n        } else if (consonantCount === 1) {\r\n          // One consonant: include current vowel only\r\n          end = vowelPos;\r\n        } else if (consonantCount === 2) {\r\n          // Two consonants: split 1+1, take first consonant\r\n          end = vowelPos + 1;\r\n        } else if (consonantCount === 3) {\r\n          // Three consonants: split 2+1, take first two\r\n          end = vowelPos + 2;\r\n        } else {\r\n          // Four or more: take half\r\n          const half = Math.floor(consonantCount / 2);\r\n          end = vowelPos + half;\r\n        }\r\n      }\r\n      \r\n      result.push([start, end]);\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Analyze a single word with optional context for choosing best pronunciation\r\n   * @param word The word to analyze\r\n   * @param expectedStress Optional expected stress pattern for this position (for meter matching)\r\n   * @param preferredSyllableCount Optional preferred syllable count (for meter fitting)\r\n   */\r\n  analyzeWord(\r\n    word: string, \r\n    expectedStress?: number,\r\n    preferredSyllableCount?: number\r\n  ): WordAnalysis {\r\n    const allPronunciations = this.getAllPronunciations(word);\r\n    \r\n    if (!allPronunciations || allPronunciations.length === 0) {\r\n      // Use fallback analysis for unknown words\r\n      return this.createFallbackAnalysis(word);\r\n    }\r\n\r\n    // If only one pronunciation, use it\r\n    if (allPronunciations.length === 1) {\r\n      const phonemes = allPronunciations[0];\r\n      const syllables = this.extractSyllables(phonemes);\r\n      const rhymeKey = this.extractRhymeKey(phonemes);\r\n\r\n      return {\r\n        word: word.toLowerCase(),\r\n        originalWord: word,\r\n        syllables,\r\n        rhymeKey,\r\n        found: true\r\n      };\r\n    }\r\n\r\n    // Multiple pronunciations: try to select the best match\r\n    let bestPronunciation = allPronunciations[0];\r\n    let bestScore = -1;\r\n\r\n    for (const phonemes of allPronunciations) {\r\n      const syllables = this.extractSyllables(phonemes);\r\n      let score = 0;\r\n\r\n      // Prefer pronunciation matching expected syllable count\r\n      if (preferredSyllableCount !== undefined) {\r\n        if (syllables.length === preferredSyllableCount) {\r\n          score += 10;\r\n        } else {\r\n          // Penalize based on difference\r\n          score -= Math.abs(syllables.length - preferredSyllableCount) * 2;\r\n        }\r\n      }\r\n\r\n      // Prefer pronunciation matching expected stress (if single syllable word)\r\n      if (expectedStress !== undefined && syllables.length === 1) {\r\n        if (syllables[0].stress === expectedStress) {\r\n          score += 5;\r\n        } else if (expectedStress === 1 && syllables[0].stress > 0) {\r\n          score += 2; // Partial match for any stress\r\n        }\r\n      }\r\n\r\n      // Default: prefer fewer syllables (more common in poetry)\r\n      score -= syllables.length * 0.5;\r\n\r\n      if (score > bestScore) {\r\n        bestScore = score;\r\n        bestPronunciation = phonemes;\r\n      }\r\n    }\r\n\r\n    const syllables = this.extractSyllables(bestPronunciation);\r\n    const rhymeKey = this.extractRhymeKey(bestPronunciation);\r\n\r\n    return {\r\n      word: word.toLowerCase(),\r\n      originalWord: word,\r\n      syllables,\r\n      rhymeKey,\r\n      found: true\r\n    };\r\n  }\r\n}\r\n","/**\r\n * 配置文件 - 管理外部资源路径和诗歌形式\r\n */\r\n\r\nimport type { LanguageConfig, SonnetForm, MeterPattern } from './types';\r\n\r\n// GitHub 仓库配置\r\nexport const GITHUB_CONFIG = {\r\n  // 开发仓库（存放源代码和数据文件）\r\n  devRepo: {\r\n    owner: 'Lilia',\r\n    name: 'sonnetaw',\r\n    branch: 'main'\r\n  },\r\n  \r\n  // 托管仓库（仅存放构建产物）\r\n  pagesRepo: {\r\n    owner: 'Lilia',\r\n    name: 'Lilia.github.io',\r\n    branch: 'main'\r\n  }\r\n};\r\n\r\n// 通用格律模式定义\r\nconst IAMBIC_PENTAMETER: MeterPattern = {\r\n  name: 'Iambic Pentameter',\r\n  description: 'Unstressed-stressed pattern, 10 syllables per line',\r\n  stressPattern: [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\r\n  syllableCount: 10,\r\n  type: 'iambic'\r\n};\r\n\r\nconst IAMBIC_HEXAMETER: MeterPattern = {\r\n  name: 'Iambic Hexameter',\r\n  description: 'Unstressed-stressed pattern, 12 syllables per line',\r\n  stressPattern: [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\r\n  syllableCount: 12,\r\n  type: 'iambic'\r\n};\r\n\r\n// 英语诗歌形式\r\nconst ENGLISH_FORMS: SonnetForm[] = [\r\n  {\r\n    id: 'shakespearean',\r\n    name: 'Shakespearean Sonnet',\r\n    description: 'ABAB CDCD EFEF GG',\r\n    rhymeScheme: ['A', 'B', 'A', 'B', 'C', 'D', 'C', 'D', 'E', 'F', 'E', 'F', 'G', 'G'],\r\n    meter: IAMBIC_PENTAMETER,\r\n    lineCount: 14\r\n  },\r\n  {\r\n    id: 'petrarchan1',\r\n    name: 'Petrarchan Sonnet (CDECDE)',\r\n    description: 'ABBAABBA CDECDE',\r\n    rhymeScheme: ['A', 'B', 'B', 'A', 'A', 'B', 'B', 'A', 'C', 'D', 'E', 'C', 'D', 'E'],\r\n    meter: IAMBIC_PENTAMETER,\r\n    lineCount: 14\r\n  },\r\n  {\r\n    id: 'petrarchan2',\r\n    name: 'Petrarchan Sonnet (CDCDCD)',\r\n    description: 'ABBAABBA CDCDCD',\r\n    rhymeScheme: ['A', 'B', 'B', 'A', 'A', 'B', 'B', 'A', 'C', 'D', 'C', 'D', 'C', 'D'],\r\n    meter: IAMBIC_PENTAMETER,\r\n    lineCount: 14\r\n  }\r\n];\r\n\r\n// 支持的语言列表（包含各自的诗歌形式）\r\nexport const SUPPORTED_LANGUAGES: LanguageConfig[] = [\r\n  {\r\n    code: 'en',\r\n    name: 'English',\r\n    dictionaryFile: 'eng-cmu.json',\r\n    poeticForms: ENGLISH_FORMS\r\n  },\r\n  // 添加拉丁语示例：\r\n  // {\r\n  //   code: 'la',\r\n  //   name: 'Latin',\r\n  //   dictionaryFile: 'latin-prosody.json',\r\n  //   poeticForms: [\r\n  //     {\r\n  //       id: 'dactylic_hexameter',\r\n  //       name: 'Dactylic Hexameter',\r\n  //       description: 'Classical epic meter (Homer, Virgil)',\r\n  //       rhymeScheme: [], // No rhyme scheme\r\n  //       meter: DACTYLIC_HEXAMETER,\r\n  //       lineCount: 0 // Variable\r\n  //     },\r\n  //     {\r\n  //       id: 'elegiac_couplet',\r\n  //       name: 'Elegiac Couplet',\r\n  //       description: 'Hexameter + Pentameter',\r\n  //       rhymeScheme: [],\r\n  //       meter: ELEGIAC_METER,\r\n  //       lineCount: 2\r\n  //     }\r\n  //   ]\r\n  // },\r\n  // 古希腊语示例：\r\n  // {\r\n  //   code: 'grc',\r\n  //   name: 'Ancient Greek',\r\n  //   dictionaryFile: 'greek-prosody.json',\r\n  //   poeticForms: [\r\n  //     {\r\n  //       id: 'sapphic_stanza',\r\n  //       name: 'Sapphic Stanza',\r\n  //       description: 'Three sapphic lines + one adonic',\r\n  //       rhymeScheme: [],\r\n  //       meter: SAPPHIC_METER,\r\n  //       lineCount: 4\r\n  //     }\r\n  //   ]\r\n  // }\r\n];\r\n\r\n// 生成 GitHub raw 文件 URL\r\nexport function getRawUrl(repo: typeof GITHUB_CONFIG.devRepo, filePath: string): string {\r\n  return `https://raw.githubusercontent.com/${repo.owner}/${repo.name}/${repo.branch}/${filePath}`;\r\n}\r\n\r\n// 生成词典 URL（根据语言代码）\r\nexport function getDictionaryUrl(languageCode: string): string {\r\n  const language = SUPPORTED_LANGUAGES.find(lang => lang.code === languageCode);\r\n  if (!language) {\r\n    throw new Error(`Unsupported language: ${languageCode}`);\r\n  }\r\n  return getRawUrl(GITHUB_CONFIG.devRepo, `public/data/${language.dictionaryFile}`);\r\n}\r\n\r\n// 数据文件路径（兼容旧代码）\r\nexport const DATA_URLS = {\r\n  cmuDict: getDictionaryUrl('en') // 默认英语\r\n};\r\n"],"names":["DictionaryService","dictData","languageCode","stored","error","word","phonemes","normalized","pronunciations","syllables","currentSyllable","currentStress","phoneme","stressMatch","lastVowelIndex","i","p","lower","specialCases","count","vowels","previousWasVowel","char","isVowel","beforeEs","before","tripleVowelMatch","match","syllableCount","stressPosition","stress","rhymeKey","result","vowelPositions","avgLength","start","end","vowelPos","prevVowel","consonantCount","half","expectedStress","preferredSyllableCount","allPronunciations","bestPronunciation","bestScore","score","GITHUB_CONFIG","IAMBIC_PENTAMETER","ENGLISH_FORMS","SUPPORTED_LANGUAGES","getRawUrl","repo","filePath","getDictionaryUrl","language","lang"],"mappings":"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"}